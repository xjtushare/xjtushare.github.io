<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="stylesheet" href="/css/post.css"><link rel="icon" href="/img/favicon.png"><title>Array 数组</title><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="blog" type="application/atom+xml">
</head><body>　　<div class="inner"><h2>Array 数组</h2><p><strong>1. 写法</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int arr[10];</span><br></pre></td></tr></table></figure>
<p><strong>2. 特性</strong><br>内存中开辟连续地址，通过内存管理器直接访问，O(1)</p>
<p><strong>3. 缺点</strong><br><img src="/2021/03/25/array/16166524808045.jpg" alt="-w629"></p>
<p><strong>4. 源代码解析 –ArrayList</strong></p>
<ol>
<li>在数据的末尾添加一个元素</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">   * Appends the specified element to the end of this list.</span><br><span class="line">   *</span><br><span class="line">   * @param e element to be appended to this list</span><br><span class="line">   * @return &lt;tt&gt;true&lt;&#x2F;tt&gt; (as specified by &#123;@link Collection#add&#125;)</span><br><span class="line">   *&#x2F;</span><br><span class="line">   &#x2F;&#x2F;1.把一个元素加入到数组最后</span><br><span class="line">  public boolean add(E e) &#123;</span><br><span class="line">  &#x2F;&#x2F;2.首先保证size有size+1这么大</span><br><span class="line">      ensureCapacityInternal(size + 1);  &#x2F;&#x2F; Increments modCount!!</span><br><span class="line">      &#x2F;&#x2F;3.然后在数据的末尾，添加上e这个元素，同时把size++，最后return true，表示添加成功</span><br><span class="line">      elementData[size++] &#x3D; e;</span><br><span class="line">      return true;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>


<ol start="2">
<li>在index位置添加一个元素</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    &#x2F;**</span><br><span class="line">     * Inserts the specified element at the specified position in this</span><br><span class="line">     * list. Shifts the element currently at that position (if any) and</span><br><span class="line">     * any subsequent elements to the right (adds one to their indices).</span><br><span class="line">     *</span><br><span class="line">     * @param index index at which the specified element is to be inserted</span><br><span class="line">     * @param element element to be inserted</span><br><span class="line">     * @throws IndexOutOfBoundsException &#123;@inheritDoc&#125;</span><br><span class="line">     *&#x2F;</span><br><span class="line">    public void add(int index, E element) &#123;</span><br><span class="line">    &#x2F;&#x2F;1、检查上下界</span><br><span class="line">        rangeCheckForAdd(index);</span><br><span class="line">&#x2F;&#x2F;2、确保容量</span><br><span class="line">        ensureCapacityInternal(size + 1);  &#x2F;&#x2F; Increments modCount!!</span><br><span class="line">       &#x2F;&#x2F;3. 拷贝： 把原来地址的起点位置，拷贝到目标地址的起点位置，source位置移动到index+1位置去</span><br><span class="line">       &#x2F;&#x2F;size-index即这个数组后半部分要挪到的部分， </span><br><span class="line">        System.arraycopy(elementData, index, elementData, index + 1,</span><br><span class="line">                         size - index);</span><br><span class="line">        &#x2F;&#x2F;填入值</span><br><span class="line">        elementData[index] &#x3D; element;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>即把EFG从3移动到了4的位置，如下图：</p>
<p><img src="/2021/03/25/array/16166535205113.jpg" alt="-w446"></p>
<p><strong>数组容量的保障策略</strong><br>如果数组的容量不够，直接new一个新的数组，新的数组的长度为当前数组的长度+当前数组长度的一半，即老数组的1.5倍。<br>然后把老数组的值拷贝到新数组中去，返回新的数组即可</p>
<p>因此如果对ArrayList进行大量修改操作，涉及到大量的array copy，所以时间复杂度是很低的。</p>
<p>为了弥补这个缺点，链表完美了解决了大量修改操作带来的时间复杂度开销问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  if (minCapacity - elementData.length &gt; 0)</span><br><span class="line">         grow(minCapacity);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line">  &#x2F;&#x2F;新数组容量为老数组的1.5</span><br><span class="line"> int newCapacity &#x3D; oldCapacity + (oldCapacity &gt;&gt; 1);</span><br><span class="line"> &#x2F;&#x2F;把所有元素拷贝到新数组中去</span><br><span class="line">elementData &#x3D; Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">     </span><br></pre></td></tr></table></figure>


<p><strong>详细代码</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line">    * Increases the capacity of this &lt;tt&gt;ArrayList&lt;&#x2F;tt&gt; instance, if</span><br><span class="line">    * necessary, to ensure that it can hold at least the number of elements</span><br><span class="line">    * specified by the minimum capacity argument.</span><br><span class="line">    *</span><br><span class="line">    * @param   minCapacity   the desired minimum capacity</span><br><span class="line">    *&#x2F;</span><br><span class="line">   public void ensureCapacity(int minCapacity) &#123;</span><br><span class="line">       int minExpand &#x3D; (elementData !&#x3D; DEFAULTCAPACITY_EMPTY_ELEMENTDATA)</span><br><span class="line">           &#x2F;&#x2F; any size if not default element table</span><br><span class="line">           ? 0</span><br><span class="line">           &#x2F;&#x2F; larger than default for default empty table. It&#39;s already</span><br><span class="line">           &#x2F;&#x2F; supposed to be at default size.</span><br><span class="line">           : DEFAULT_CAPACITY;</span><br><span class="line"></span><br><span class="line">       if (minCapacity &gt; minExpand) &#123;</span><br><span class="line">           ensureExplicitCapacity(minCapacity);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   private static int calculateCapacity(Object[] elementData, int minCapacity) &#123;</span><br><span class="line">       if (elementData &#x3D;&#x3D; DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">           return Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">       &#125;</span><br><span class="line">       return minCapacity;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   private void ensureCapacityInternal(int minCapacity) &#123;</span><br><span class="line">       ensureExplicitCapacity(calculateCapacity(elementData, minCapacity));</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   private void ensureExplicitCapacity(int minCapacity) &#123;</span><br><span class="line">       modCount++;</span><br><span class="line"></span><br><span class="line">       &#x2F;&#x2F; overflow-conscious code</span><br><span class="line">       if (minCapacity - elementData.length &gt; 0)</span><br><span class="line">           grow(minCapacity);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line">  * Increases the capacity to ensure that it can hold at least the</span><br><span class="line">  * number of elements specified by the minimum capacity argument.</span><br><span class="line">  *</span><br><span class="line">  * @param minCapacity the desired minimum capacity</span><br><span class="line">  *&#x2F;</span><br><span class="line"> private void grow(int minCapacity) &#123;</span><br><span class="line">     &#x2F;&#x2F; overflow-conscious code</span><br><span class="line">     int oldCapacity &#x3D; elementData.length;</span><br><span class="line">     &#x2F;&#x2F;新数组容量</span><br><span class="line">     int newCapacity &#x3D; oldCapacity + (oldCapacity &gt;&gt; 1);</span><br><span class="line">     if (newCapacity - minCapacity &lt; 0)</span><br><span class="line">         newCapacity &#x3D; minCapacity;</span><br><span class="line">     if (newCapacity - MAX_ARRAY_SIZE &gt; 0)</span><br><span class="line">         newCapacity &#x3D; hugeCapacity(minCapacity);</span><br><span class="line">     &#x2F;&#x2F; minCapacity is usually close to size, so this is a win:</span><br><span class="line">     &#x2F;&#x2F;把所有元素拷贝到新数组中去</span><br><span class="line">     elementData &#x3D; Arrays.copyOf(elementData, newCapacity);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</div><script src="/js/jquery.min.js"></script><script src="/js/main.js"></script></body></html>